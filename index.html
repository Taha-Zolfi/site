<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taha Zolfi</title>

    <!-- ÙÙˆÙ†Øª ÙˆØ²ÛŒØ±Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ ÙØ§Ø±Ø³ÛŒ -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø§ÛŒØª Ø§ØµÙ„ÛŒ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }

        body {
            margin: 0;
            overflow-x: hidden;
            font-family: 'open sans';
            background-color: black;
        }

        html,
        body {
            scroll-behavior: smooth;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgb(0, 0, 0);
        }

        ::-webkit-scrollbar-thumb {
            background: #00ffa7;
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }

        .nav {
            position: fixed;
            width: 100%;
            background: rgba(0, 0, 0, 0.37);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-bottom: 1px solid #9ba3b446;
            z-index: 1000;
            display: flex;
            justify-content: center;
            border-end-end-radius: 15px;
            border-end-start-radius: 15px;
            box-shadow: 0 4px 30px rgba(255, 255, 255, 0.055);
            transition: opacity 0.5s ease;
        }

        .nav.hidden {
            opacity: 0;
        }

        .nav ul {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav ul li {
            display: inline-block;
            padding: 0.7rem 1.7rem;
        }

        .nav ul li a {
            font-weight: 100;
            font-size: 30px;
            padding: 19px 16px;
            cursor: pointer;
            position: relative;
            color: #e9eaeb81;
            text-decoration: none;
        }

        li a:hover {
            color: #e9eaeb;
        }

        li a::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            border-radius: 114px;
            background-color: #00ffa7;
            bottom: 15px;
            left: 0;
            transform-origin: right;
            transform: scaleX(0);
            transition: transform .3s ease-in-out;
        }

        li a:hover::before {
            transform-origin: left;
            transform: scaleX(1);
        }

        .next {
            height: 70vh;
            background: #0e0e0e;
            color: #e9eaeb;
            --gap: 5em;
            --line: 1px;
            --color: rgba(255, 255, 255, 0.2);
            background-image: linear-gradient(-90deg, transparent calc(var(--gap) - var(--line)), var(--color) calc(var(--gap) - var(--line) + 1px), var(--color) var(--gap)), linear-gradient(0deg, transparent calc(var(--gap) - var(--line)), var(--color) calc(var(--gap) - var(--line) + 1px), var(--color) var(--gap));
            background-size: var(--gap) var(--gap);
        }

        h1 {
            font-size: 5vw;
            font-weight: 900;
            padding-bottom: 2rem;
            padding-top: 2rem;
            text-align: center;
        }

        .next p {
            padding: 2rem;
            width: 50vw;
            font-weight: 600;
            font-size: larger;
            text-align: center;
            line-height: 1.4;
            color: #9ba3b4;
        }

        .third {
            height: auto;
            background: #0e0e0e;
            color: #e9eaeb;
            --gap: 5em;
            --line: 1px;
            --color: rgba(255, 255, 255, 0.2);
            background-image: linear-gradient(-90deg, transparent calc(var(--gap) - var(--line)), var(--color) calc(var(--gap) - var(--line) + 1px), var(--color) var(--gap)), linear-gradient(0deg, transparent calc(var(--gap) - var(--line)), var(--color) calc(var(--gap) - var(--line) + 1px), var(--color) var(--gap));
            background-size: var(--gap) var(--gap);
        }

        .fourth {
            height: 70vh;
            background: #0e0e0e;
            color: #e9eaeb;
            --gap: 5em;
            --line: 1px;
            --color: rgba(255, 255, 255, 0.2);
            background-image: linear-gradient(-90deg, transparent calc(var(--gap) - var(--line)), var(--color) calc(var(--gap) - var(--line) + 1px), var(--color) var(--gap)), linear-gradient(0deg, transparent calc(var(--gap) - var(--line)), var(--color) calc(var(--gap) - var(--line) + 1px), var(--color) var(--gap));
            background-size: var(--gap) var(--gap);
        }

        .fourth img {
            width: 4vw;
            margin: 2rem;
        }

        .m {
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        .fifth {
            color: white;
            background-color: #000000;
        }

        .c h1 {
            display: inline-block;
            position: relative;
            padding: 1rem 2rem;
            color: #e9eaeb;
            z-index: 1;
            font-size: 5vw;
            text-align: center;
            transition: all 0.3s ease-in-out;
        }

        .c h1::before {
            content: '';
            position: absolute;
            bottom: 15px;
            width: 100%;
            height: 4px;
            z-index: -1;
            left: 0;
            right: 0;
            background: #00ffa7;
            border-radius: 15px;
            transition: all 0.3s ease-in-out;
        }

        .c h1:hover {
            color: #0e0e0e;
            -webkit-text-stroke: 3px #00ffa7;
        }

        .c h1:hover::before {
            height: 50%;
            bottom: 0;
            filter: drop-shadow(0 0 15px #00ffa7);
        }

        .c {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        strong {
            color: #00ffa7;
        }

        .swiper img {
            width: 20vw;
            border-radius: 15px;
        }

        @media (orientation: portrait) {
            .nav {
                display: none;
            }

            .next p {
                width: 90vw;
            }

            .next {
                height: max-content;
            }

            .next h1 {
                font-size: 8vw;
            }

            .c h1 {
                display: inline-block;
                position: relative;
                padding: 1.5rem;
                color: #e9eaeb;
                z-index: 1;
                font-size: 9vw;
                text-align: center;
                transition: all 0.3s ease-in-out;
            }

            .fourth {
                height: 50vh;
            }

            .c h1::before {
                content: '';
                position: absolute;
                bottom: 15px;
                width: 100%;
                height: 4px;
                z-index: -1;
                left: 0;
                right: 0;
                background: #00ffa7;
                border-radius: 10px;
                transition: all 0.3s ease-in-out;
            }

            .c h1:hover {
                color: #0e0e0e;
                -webkit-text-stroke: 1px #00ffa7;
            }

            .c h1:hover::before {
                height: 50%;
                bottom: 0;
                filter: drop-shadow(0 0 15px #00ffa7);
            }

            .fourth img {
                width: 10vw;
                margin: 0.7rem;
            }

            .swiper img {
                width: 30vw;
                border-radius: 8px;
            }

            #d {
                display: none;
            }

            .m {
                display: flex;
                flex-direction: column;
            }

            .p1 {
                display: flex;
                justify-content: center;
            }
        }

        .column {
            width: 20%;
            padding: 0 10px;
        }

        .row {
            margin: 15PX;
            display: flex;
            justify-content: center;
        }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .card img {
            width: 5vw;
        }

        .card {
            color: #e9eaeb;
            padding: 25px;
            text-align: center;
            background-color: #0e0e0e;
            border: solid 1px #00ffa7;
            border-radius: 15px;
        }

        .card h3 {
            color: #00ffa7;
            padding: 1rem;
        }

        @media screen and (max-width: 600px) {
            .column {
                width: 100%;
                display: block;
                margin-bottom: 20px;
            }

            .row {
                flex-direction: column;
            }

            .column h3 {
                display: none;
            }

            .card {
                display: flex;
                align-items: center;
                font-size: larger;
            }

            .card img {
                width: 10vw;
                margin-right: 1rem;
            }

            h1 {
                font-size: 9vw;
            }
        }

        /* -------------------------------------------------------------------
           PREMIUM SECRET SYSTEM STYLES (KETABINO)
           ------------------------------------------------------------------- */
        :root {
            --accent: #00ffa7;
            --accent-glow: rgba(0, 255, 167, 0.4);
            --bg-dark: #080808;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #efefef;
            --text-dim: #999;
        }

        #secret-container,
        #secret-container * {
            font-family: 'Vazirmatn', sans-serif !important;
        }

        #secret-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            z-index: 100000;
            overflow: hidden;
            color: var(--text-main);
            direction: rtl;
        }

        /* Background Pattern Utility */
        .bg-pattern {
            background-color: var(--bg-dark);
            background-image:
                radial-gradient(var(--accent) 0.5px, transparent 0.5px),
                radial-gradient(var(--accent) 0.5px, var(--bg-dark) 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.03;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        /* === Premium Login === */
        #login-view {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #151515 0%, #050505 100%);
            padding: 24px;
            position: relative;
        }

        .login-card {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            padding: 2px;
            /* For the gradient border */
            border-radius: 40px;
            background: linear-gradient(135deg, var(--accent), transparent, #00d1ff);
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.9);
            width: 100%;
            max-width: 460px;
            animation: cardEnter 1s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .login-card-inner {
            background: #080808;
            border-radius: 38px;
            padding: 50px 40px;
            width: 100%;
            height: 100%;
            text-align: center;
        }

        @keyframes cardEnter {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .ketabino-logo {
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 5px;
            background: linear-gradient(180deg, #fff 40%, var(--accent) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
            filter: drop-shadow(0 0 15px rgba(0, 255, 167, 0.3));
        }

        .login-subtitle {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 40px;
            font-weight: 400;
        }

        .login-input {
            width: 100%;
            padding: 22px 24px;
            background: #111;
            border: 1px solid #222;
            border-radius: 20px;
            color: #fff;
            font-size: 1.4rem;
            text-align: center;
            outline: none;
            transition: all 0.4s;
            margin-bottom: 25px;
        }

        .login-input:focus {
            border-color: var(--accent);
            background: #151515;
            box-shadow: 0 0 30px rgba(0, 255, 167, 0.15);
            transform: translateY(-2px);
        }

        .login-btn {
            width: 100%;
            padding: 22px;
            background: var(--accent);
            color: #000;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 900;
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            text-transform: uppercase;
        }

        .login-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0, 255, 167, 0.4);
            filter: brightness(1.1);
        }

        /* === Premium Chat View === */
        #chat-view {
            display: none;
            flex-direction: column;
            height: 100%;
            background: #0a0a0a;
            position: relative;
        }

        .chat-header {
            height: 70px;
            padding: 0 24px;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .online-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .online-dot {
            width: 10px;
            height: 10px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 12px var(--accent);
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse-green {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 255, 167, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(0, 255, 167, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(0, 255, 167, 0);
            }
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 85%;
            padding: 14px 18px;
            border-radius: 22px;
            position: relative;
            font-size: 0.95rem;
            line-height: 1.6;
            animation: msgFadeUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            word-wrap: break-word;
        }

        @keyframes msgFadeUp {
            from {
                opacity: 0;
                transform: translateY(12px) scale(0.98);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .msg-incoming {
            align-self: flex-start;
            background: #181818;
            color: #efefef;
            border-bottom-right-radius: 4px;
            /* Fix for RTL */
            border-bottom-left-radius: 22px;
            border: 1px solid #222;
        }

        .msg-outgoing {
            align-self: flex-end;
            background: linear-gradient(135deg, #00ffa7 0%, #00d1ff 100%);
            color: #000;
            border-bottom-left-radius: 4px;
            /* Fix for RTL */
            border-bottom-right-radius: 22px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 255, 167, 0.15);
        }

        .msg-timer-wrap {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.65rem;
            margin-top: 6px;
            opacity: 0.5;
        }

        .msg-outgoing .msg-timer-wrap {
            justify-content: flex-end;
            color: #000;
        }

        .typing-pill {
            margin: 0 24px 12px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent);
            width: fit-content;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        #panic-footer {
            padding: 0 20px 20px;
        }

        .panic-btn-v2 {
            width: 100%;
            background: #ff3b30;
            color: #fff;
            border: none;
            padding: 18px;
            border-radius: 18px;
            font-weight: 900;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(255, 59, 48, 0.3);
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .chat-input-wrapper {
            padding: 16px 20px;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            gap: 12px;
            align-items: center;
            border-top: 1px solid #1a1a1a;
        }

        #msg-input {
            flex: 1;
            padding: 14px 24px;
            background: #111;
            border: 1px solid #222;
            border-radius: 30px;
            color: #fff;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        #msg-input:focus {
            border-color: var(--accent);
        }

        #send-btn {
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: #000;
            transition: transform 0.2s;
        }

        #send-btn:hover {
            transform: scale(1.08) rotate(-10deg);
        }

        /* === Premium Article (Panic View) === */
        #panic-view {
            display: none;
            height: 100%;
            overflow-y: auto;
            background: #fff;
            color: #1a1a1a;
            direction: rtl;
        }

        .article-hero {
            background: #fafafa;
            padding: 100px 24px 70px;
            border-bottom: 1px solid #eee;
            margin-bottom: 50px;
            text-align: center;
        }

        .article-hero h1 {
            font-size: 3.5rem;
            font-weight: 950;
            color: #000;
            line-height: 1.1;
            margin-bottom: 25px;
            letter-spacing: -1px;
        }

        .article-meta-v2 {
            display: flex;
            gap: 20px;
            color: #999;
            font-size: 1.1rem;
            justify-content: center;
        }

        .article-content-v2 {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 24px 150px;
        }

        .article-content-v2 h2 {
            font-size: 2rem;
            font-weight: 800;
            margin: 60px 0 30px;
            color: #111;
            border-right: 5px solid var(--accent);
            padding-right: 20px;
        }

        .article-content-v2 p {
            font-size: 1.3rem;
            line-height: 2.2;
            margin-bottom: 30px;
            text-align: justify;
            color: #333;
        }

        .math-card-v2 {
            background: #f8f9fa;
            padding: 50px;
            border-radius: 30px;
            border: 1px solid #eee;
            text-align: center;
            margin: 50px 0;
            font-family: 'Times New Roman', serif !important;
            font-size: 2.5rem;
            color: #000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
        }

        .math-card-v2::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 6px;
            height: 100%;
            background: #3498db;
        }

        .fake-return-dot {
            margin-top: 80px;
            text-align: center;
            opacity: 0.05;
            cursor: pointer;
            padding: 40px;
            font-size: 2rem;
        }

        /* Trigger */
        .secret-trigger {
            width: 100%;
            background: #0e0e0e;
            padding: 40px 0;
            text-align: center;
        }

        .secret-trigger a {
            color: #00ffa7;
            text-decoration: none;
            font-weight: 800;
            font-size: 1.1rem;
            transition: 0.3s;
            opacity: 0.7;
        }

        .secret-trigger a:hover {
            opacity: 1;
            text-shadow: 0 0 15px var(--accent-glow);
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>
    <!-- Main page content remains the same -->
    <div class="nav" id="blur">
        <ul>
            <li><a class="last" href="#canvas-container">HOME</a></li>
            <li><a class="last" href="#next">ABOUT ME</a></li>
            <li><a class="last" href="#third">PROJECTS</a></li>
            <li><a class="last" href="#fourth">SKILLS</a></li>
            <li><a class="last" href="#fifth">CONTACT</a></li>
        </ul>
    </div>
    <div id="canvas-container"></div>
    <script> AOS.init(); </script>
    <div id="next" class="next c">
        <h1>WHO AM I ?</h1>
        <p>Hello! I am an 18-year-old developer and graphic designer from iran with a passion for graphic design and
            programming...</p>
    </div>
    <div class="third " id="third">
        <h1>PROJECTS</h1>
        <div class="swiper">
            <div class="swiper-wrapper">
                <div class="swiper-slide"><a href="#"><img src="card1.jpg"></a></div>
                <div class="swiper-slide"><a href="#"><img src="card2.jpg"></a></div>
                <div class="swiper-slide"><a href="#"><img src="card3.jpg"></a></div>
                <div class="swiper-slide"><a href="#"><img src="card4.jpg"></a></div>
                <div class="swiper-slide"><a href="#"><img src="card5.jpg"></a></div>
            </div>
        </div>
    </div>
    <div class="fourth" id="fourth">
        <h1>SKILLS</h1>
        <div class="m">
            <div class="p1">
                <img src="imgs/l1.png" alt="Skill 1" data-aos="fade-up" data-aos-delay="100">
                <img src="imgs/l2.png" alt="Skill 2" data-aos="fade-up" data-aos-delay="200">
            </div>
        </div>
    </div>
    <div class="fifth" id="fifth">
        <h1>CONTACT ME</h1>
        <div class="row">
            <div class="column"><a href="#">
                    <div class="card"><img src="imgs/igg.png">
                        <h3>Instagram</h3>
                        <p>021gorb</p>
                    </div>
                </a></div>
            <div class="column"><a href="#">
                    <div class="card"><img src="imgs/tl.png">
                        <h3>Telegram</h3>
                        <p>Dr_coode</p>
                    </div>
                </a></div>
            <div class="column"><a href="#">
                    <div class="card"><img src="imgs/ph.png">
                        <h3>Number</h3>
                        <p>+989906648574</p>
                    </div>
                </a></div>
            <div class="column"><a href="#">
                    <div class="card"><img src="imgs/emm.png">
                        <h3>Email</h3>
                        <p>tahazolfi01@gmail.com</p>
                    </div>
                </a></div>
        </div>
    </div>
    <div class="secret-trigger">
        <a href="javascript:void(0)" onclick="openKetabino()">Ø±Ùˆ Ø§ÛŒÙ† Ø¨Ø²Ù†</a>
    </div>

    <!-- 
    =======================================================
                    SECRET KETABINO SYSTEM
    =======================================================
    -->
    <div id="secret-container">
        <!-- Premium Login -->
        <div id="login-view">
            <div class="bg-pattern" style="opacity: 0.05;"></div>
            <div class="login-card">
                <div class="login-card-inner">
                    <div class="ketabino-logo">Ú©ØªØ§Ø¨ÛŒÙ†Ùˆ</div>
                    <div class="login-subtitle">Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¢Ù…ÙˆØ²Ø´ Ø­Ø³Ø§Ø¨Ø§Ù† Ùˆ Ø±ÛŒØ§Ø¶ÛŒØ§Øª ØªØ­Ù„ÛŒÙ„ÛŒ</div>
                    <div class="login-input-wrapper">
                        <input type="password" id="secret-pass" class="login-input" placeholder="Ú©Ø¯ Ø¯Ø³ØªØ±Ø³ÛŒ"
                            maxlength="6">
                    </div>
                    <button class="login-btn" onclick="checkSecretPass()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡</button>
                    <p id="login-error"
                        style="color:#ff3b30; margin-top:20px; display:none; font-weight:bold; font-size:0.9rem;">Ú©Ø¯
                        Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª</p>
                </div>
            </div>
        </div>

        <!-- Premium Chat -->
        <div id="chat-view">
            <div class="bg-pattern" style="opacity: 0.02;"></div>
            <div class="chat-header">
                <div class="header-info">
                    <div style="font-weight: 800; font-size: 1.1rem; letter-spacing: 0.5px;">Ù¾Ù†Ù„ Ú¯ÙØªÚ¯Ùˆ</div>
                    <div class="online-status">
                        <div class="online-dot"></div>
                        <span id="online-count">Û° Ù†ÙØ± Ø¢Ù†Ù„Ø§ÛŒÙ†</span>
                    </div>
                </div>
                <div style="color: var(--accent); font-weight: 900; font-size: 0.75rem; opacity: 0.8;">Ù¾Ø±ÙˆÚ˜Ù‡ Ú©ØªØ§Ø¨ÛŒÙ†Ùˆ
                </div>
            </div>

            <div id="chat-area" class="chat-area" style="position: relative; z-index: 1;"></div>

            <div id="typing-status" class="typing-pill" style="position: relative; z-index: 1;"></div>

            <div id="panic-footer" style="position: relative; z-index: 1;">
                <button class="panic-btn-v2" onclick="triggerPanic()">
                    <span>âš </span> Ø®Ø±ÙˆØ¬ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
                </button>
            </div>

            <div class="chat-input-wrapper" style="position: relative; z-index: 1;">
                <label for="file-upload" style="cursor:pointer; font-size:1.5rem; opacity:0.6;">ğŸ“</label>
                <input type="file" id="file-upload" style="display:none" accept="image/*" onchange="uploadImage()">
                <input type="text" id="msg-input" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." autocomplete="off">
                <button id="send-btn" onclick="sendMessage()">â¤</button>
            </div>
        </div>

        <!-- Premium Article -->
        <div id="panic-view">
            <div class="article-hero">
                <div class="article-content-v2">
                    <div class="article-meta-v2">
                        <span>Ø¬Ù„Ø³Ù‡ Û±Û²: Ø¢Ù†Ø§Ù„ÛŒØ² Ø±ÛŒØ§Ø¶ÛŒ</span>
                        <span>â€¢</span>
                        <span>Ø¯Ú©ØªØ± Ø³Ù‡Ø±Ø§Ø¨ÛŒ</span>
                    </div>
                    <h1>Ù…Ø´ØªÙ‚ ØªÙˆØ§Ø¨Ø¹ Ùˆ Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø¯Ø± Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ</h1>
                </div>
            </div>

            <div class="article-content-v2">
                <p>Ø¯Ø± Ø§ÛŒÙ† Ù…Ø¨Ø­Ø«ØŒ Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…ÛŒÙ‚â€ŒØªØ± Ù…ÙÙ‡ÙˆÙ… Ù…Ø´ØªÙ‚ Ùˆ Ù†Ù‚Ø´ Ø­ÛŒØ§ØªÛŒ Ø¢Ù† Ø¯Ø± ØªØ¹ÛŒÛŒÙ† Ø±ÙØªØ§Ø± ØªÙˆØ§Ø¨Ø¹ Ù…ÛŒâ€ŒÙ¾Ø±Ø¯Ø§Ø²ÛŒÙ…. Ù…Ø´ØªÙ‚ Ù†Ù‡ ØªÙ†Ù‡Ø§
                    Ø´ÛŒØ¨ Ø®Ø· Ù…Ù…Ø§Ø³ Ø¨Ù„Ú©Ù‡ Ù†Ø±Ø® ØªØºÛŒÛŒØ±Ø§Øª Ø¢Ù†ÛŒ Ø±Ø§ Ø¯Ø± Ù‡Ø± Ù„Ø­Ø¸Ù‡ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>

                <h2>Û±. ØªØ¹Ø±ÛŒÙ ØµÙˆØ±ÛŒ Ù…Ø´ØªÙ‚</h2>
                <p>Ø§Ú¯Ø± ØªØ§Ø¨Ø¹ÛŒ Ø¯Ø± Ù‡Ù…Ø³Ø§ÛŒÚ¯ÛŒ Ù†Ù‚Ø·Ù‡ a ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø´ØªÙ‚ Ø¢Ù† Ø¯Ø± Ø§ÛŒÙ† Ù†Ù‚Ø·Ù‡ Ø¨ØµÙˆØ±Øª Ø­Ø¯ Ø²ÛŒØ± ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯ Ú©Ù‡
                    Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø´ÛŒØ¨ Ø®Ø· Ù…Ù…Ø§Ø³ Ø§Ø³Øª:</p>
                <div class="math-card-v2">
                    f'(a) = lim<sub>hâ†’0</sub> [f(a + h) - f(a)] / h
                </div>

                <h2>Û². Ù‚Ø¶ÛŒÙ‡ Ù…Ù‚Ø¯Ø§Ø± Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†</h2>
                <p>Ø§ÛŒÙ† Ù‚Ø¶ÛŒÙ‡ Ø¨ÛŒØ§Ù† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø§Ú¯Ø± ØªØ§Ø¨Ø¹ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ù‡ [a, b] Ù¾ÛŒÙˆØ³ØªÙ‡ Ùˆ Ø¯Ø± (a, b) Ù…Ø´ØªÙ‚â€ŒÙ¾Ø°ÛŒØ± Ø¨Ø§Ø´Ø¯ØŒ Ù†Ù‚Ø·Ù‡â€ŒØ§ÛŒ Ù…Ø§Ù†Ù†Ø¯ c
                    Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ Ú©Ù‡ Ø´ÛŒØ¨ Ø®Ø· Ù…Ù…Ø§Ø³ Ø¯Ø± Ø¢Ù† Ø¨Ø§ Ø´ÛŒØ¨ Ø®Ø· ÙˆØ§ØµÙ„ Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ø§Ø¨ØªØ¯Ø§ Ùˆ Ø§Ù†ØªÙ‡Ø§ Ø¨Ø±Ø§Ø¨Ø± Ø§Ø³Øª.</p>
                <div class="math-card-v2">
                    f'(c) = [f(b) - f(a)] / (b - a)
                </div>

                <h2>Û³. Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ù†Ù‚Ø§Ø· Ø¨Ø­Ø±Ø§Ù†ÛŒ</h2>
                <p>Ø¨Ø±Ø§ÛŒ ÛŒØ§ÙØªÙ† Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨ÛŒØ´ÛŒÙ†Ù‡ Ùˆ Ú©Ù…ÛŒÙ†Ù‡ØŒ Ø§Ø² Ù…Ø´ØªÙ‚ Ø§ÙˆÙ„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…. Ù†Ù‚Ø§Ø·ÛŒ Ú©Ù‡ Ù…Ø´ØªÙ‚ Ø¯Ø± Ø¢Ù†â€ŒÙ‡Ø§ ØµÙØ± ÛŒØ§ ØªØ¹Ø±ÛŒÙ
                    Ù†Ø´Ø¯Ù‡ Ø§Ø³ØªØŒ Ù†Ù‚Ø§Ø· Ø¨Ø­Ø±Ø§Ù†ÛŒ Ù†Ø§Ù…ÛŒØ¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ø¨Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù„Ø§Ù…Øª Ù…Ø´ØªÙ‚ Ø¯Ø± Ø·Ø±ÙÛŒÙ† Ø§ÛŒÙ† Ù†Ù‚Ø§Ø·ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø§Ú©Ø³ØªØ±Ù…Ù…â€ŒÙ‡Ø§ Ø±Ø§
                    ØªØ¹ÛŒÛŒÙ† Ú©Ø±Ø¯.</p>

                <p>Ø¯Ø± Ù…Ø³Ø§Ø¦Ù„ Ø§Ù‚ØªØµØ§Ø¯ÛŒØŒ Ø§ÛŒÙ† Ù…ÙÙ‡ÙˆÙ… Ø¨Ø±Ø§ÛŒ ÛŒØ§ÙØªÙ† Ù†Ù‚Ø·Ù‡ Ø³Ø±Ø¨Ù‡ Ø³Ø± Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± Ø³ÙˆØ¯ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ø´ØªÙ‚ ØªØ§Ø¨Ø¹ Ù‡Ø²ÛŒÙ†Ù‡ Ùˆ
                    Ø¯Ø±Ø¢Ù…Ø¯ Ø¨Ú©Ø§Ø± Ù…ÛŒâ€ŒØ±ÙˆØ¯.</p>

                <div class="fake-return-dot" onclick="returnToLogin()">.</div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Three.js and other initial scripts remain the same
        const scene = new THREE.Scene();
        // ... (Ú©Ø¯Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ three.js Ùˆ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯)
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById("canvas-container").appendChild(renderer.domElement);
        const particlesGeometry = new THREE.BufferGeometry();
        const count = 5000;
        const positions = new Float32Array(count * 3);
        for (let i = 0; i < count * 3; i++) positions[i] = (Math.random() - 0.5) * 100;
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const particlesMaterial = new THREE.PointsMaterial({ color: "#00ffa7", size: 0.1 });
        const particles = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particles);
        const light = new THREE.PointLight(0xffffff, 1, 1000);
        light.position.set(10, 10, 10);
        scene.add(light);
        const loader = new THREE.FontLoader();
        loader.load('spike.json', function (font) {
            const geometry = new THREE.TextGeometry('TAHA ZOLFI', {
                font: font, size: 1, height: 0.2, curveSegments: 12, bevelEnabled: true, bevelThickness: 0.03, bevelSize: 0.02, bevelSegments: 5
            });
            geometry.center();
            const material = new THREE.MeshStandardMaterial({ color: 0x00ffa7 });
            const mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);
        }, undefined, function () { });
        camera.position.z = 5;
        function animate() { requestAnimationFrame(animate); particles.rotation.y += 0.001; renderer.render(scene, camera); }
        animate();

        document.addEventListener('DOMContentLoaded', () => {
            const nav = document.querySelector('.nav');
            let lastScrollTop = 0;
            window.addEventListener('scroll', () => {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (scrollTop > lastScrollTop) nav.classList.add('hidden');
                else nav.classList.remove('hidden');
                lastScrollTop = scrollTop;
            });
        });
        const swiper = new Swiper('.swiper', {
            speed: 300, spaceBetween: 100, loop: true, autoplay: { delay: 1000 },
            grabCursor: true, centeredSlides: true,
            breakpoints: { 320: { slidesPerView: 3, spaceBetween: 20 }, 480: { slidesPerView: 3, spaceBetween: 30 }, 640: { slidesPerView: 4, spaceBetween: 40 } }
        });
    </script>

    <!-- =======================================================
               FIXED & IMPROVED Supabase and Chat Scripts
         ======================================================= -->
    <script>
        let currentUser = 'user-' + Math.random().toString(36).substring(2, 9);
        let channel;
        let deleteTimers = {};

        function openKetabino() {
            document.getElementById('secret-container').style.display = 'block';
            document.getElementById('login-view').style.display = 'flex';
            document.getElementById('chat-view').style.display = 'none';
            document.getElementById('panic-view').style.display = 'none';
            document.body.style.overflow = 'hidden';
        }

        async function triggerPanic() {
            document.getElementById('chat-view').style.display = 'none';
            document.getElementById('panic-view').style.display = 'block';

            // Local cleanup
            document.getElementById('chat-area').innerHTML = '';

            // Broadcast clear signal to others if possible (using common broadcast)
            if (channel) {
                channel.send({
                    type: 'broadcast',
                    event: 'clear_chat',
                    payload: {}
                });
            }
        }

        function returnToLogin() {
            document.getElementById('panic-view').style.display = 'none';
            document.getElementById('login-view').style.display = 'flex';
            document.getElementById('secret-pass').value = '';
        }

        function toEnglishDigits(str) {
            return str.replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d));
        }

        function playJoinSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                if (audioContext.state === 'suspended') audioContext.resume();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) { }
        }

        const SUPABASE_URL = 'https://oklfwsnkaxbqlnjpownj.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9rbGZ3c25rYXhicWxuanBvd25qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwOTkwMTAsImV4cCI6MjA3MzY3NTAxMH0.apanbRV3o5afJ5ivDHimjvYQY1JqawWcIsGemW0jyMg';

        let db;
        try { db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY); } catch (e) { console.error(e); }

        const validPasswords = ['914920', '920914'];

        function checkSecretPass() {
            let input = document.getElementById('secret-pass').value;
            input = toEnglishDigits(input);
            if (validPasswords.includes(input)) {
                document.getElementById('login-view').style.display = 'none';
                document.getElementById('chat-view').style.display = 'flex';
                initChat();
            } else {
                const err = document.getElementById('login-error');
                err.style.display = 'block';
                setTimeout(() => err.style.display = 'none', 3000);
            }
        }

        function startMessageTimer(id, seconds = 60) {
            const timerEl = document.querySelector(`#msg-${id} .timer-val`);
            if (!timerEl) return;

            let remaining = seconds;
            const interval = setInterval(() => {
                remaining--;
                if (timerEl) timerEl.textContent = remaining + 's';
                if (remaining <= 0) {
                    clearInterval(interval);
                    const msgEl = document.getElementById('msg-' + id);
                    if (msgEl) {
                        msgEl.style.opacity = '0';
                        msgEl.style.transform = 'scale(0.8)';
                        setTimeout(() => msgEl.remove(), 400);
                    }
                }
            }, 1000);
        }

        function renderMessage(msg, direction = 'incoming') {
            const chatArea = document.getElementById('chat-area');
            if (document.getElementById('msg-' + msg.id)) return;

            const div = document.createElement('div');
            div.id = 'msg-' + msg.id;
            div.className = `message msg-${direction}`;

            let innerContent = '';
            if (msg.type === 'image') {
                innerContent = `<img src="${msg.content}" style="max-width:100%; border-radius:12px; display:block; margin-bottom:8px;">`;
            } else {
                innerContent = `<div>${msg.content}</div>`;
            }

            div.innerHTML = `
                ${innerContent}
                <div class="msg-timer-wrap">
                    <span>â±</span>
                    <span class="timer-val">60s</span>
                </div>
            `;

            chatArea.appendChild(div);
            chatArea.scrollTop = chatArea.scrollHeight;

            startMessageTimer(msg.id, 60);
        }

        async function sendMessage(type = 'text', content = null) {
            if (!db) return;
            const textInput = document.getElementById('msg-input');
            const msgContent = content || textInput.value;
            if (!msgContent.trim()) return;

            if (type === 'text') textInput.value = '';

            // Using session storage to track our own messages since table lacks 'sender' col
            const sentIds = JSON.parse(localStorage.getItem('sentMessages') || '[]');

            const { data, error } = await db.from('messages').insert([{
                content: msgContent,
                type: type
                // Removed 'sender' to avoid 400 error
            }]).select();

            if (!error && data && data.length > 0) {
                sentIds.push(data[0].id);
                localStorage.setItem('sentMessages', JSON.stringify(sentIds));
                renderMessage(data[0], 'outgoing');
            }
        }

        // Typing logic
        let typingTimeout;
        document.getElementById('msg-input').addEventListener('input', () => {
            if (!channel) return;
            channel.track({ typing: true, user: currentUser });
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                channel.track({ typing: false, user: currentUser });
            }, 2500);
        });

        document.getElementById('msg-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        async function uploadImage() {
            if (!db) return;
            const fileInput = document.getElementById('file-upload');
            const file = fileInput.files[0];
            if (!file) return;
            const fileName = Date.now() + '_' + file.name;

            const { error } = await db.storage.from('images').upload(fileName, file);
            if (error) return;

            const { data: { publicUrl } } = db.storage.from('images').getPublicUrl(fileName);
            sendMessage('image', publicUrl);
        }

        function initChat() {
            if (!db) return;
            const chatArea = document.getElementById('chat-area');
            chatArea.innerHTML = '';
            localStorage.removeItem('sentMessages');

            // CHAT HISTORY DISABLED FOR PRIVACY
            /*
            db.from('messages')
                .select('*')
                .order('created_at', { ascending: false })
                .limit(20)
                .then(({ data, error }) => {
                    if (!error && data) {
                        data.reverse().forEach(msg => {
                            renderMessage(msg, 'incoming');
                        });
                    }
                });
            */

            // Channel with Presence
            channel = db.channel('realtime-ops', {
                config: { presence: { key: currentUser } }
            });

            channel
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
                    const sentIds = JSON.parse(localStorage.getItem('sentMessages') || '[]');
                    if (!sentIds.includes(payload.new.id)) {
                        renderMessage(payload.new, 'incoming');
                        playJoinSound();
                    }
                })
                .on('presence', { event: 'sync' }, () => {
                    const state = channel.presenceState();
                    const count = Object.keys(state).length;
                    document.getElementById('online-count').textContent = count + ' Ù†ÙØ± Ø¢Ù†Ù„Ø§ÛŒÙ†';

                    let isAnyTyping = false;
                    for (const id in state) {
                        state[id].forEach(u => {
                            if (u.typing && id !== currentUser) isAnyTyping = true;
                        });
                    }
                    const typingPill = document.getElementById('typing-status');
                    typingPill.style.display = isAnyTyping ? 'block' : 'none';
                    typingPill.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ†...';
                })
                .on('broadcast', { event: 'clear_chat' }, () => {
                    document.getElementById('chat-area').innerHTML = '';
                })
                .subscribe(async (status) => {
                    if (status === 'SUBSCRIBED') {
                        await channel.track({ online_at: new Date().toISOString(), typing: false });
                    }
                });
        }
    </script>
</body>

</html>
