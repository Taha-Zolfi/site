<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taha Zolfi - Final</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #00ffa7;
            --dark-bg: #0d0d0d;
            --medium-bg: #1a1a1a;
            --light-text: #e0e0e0;
            --dark-text: #111;
            --red-panic: #ff1b4c;
        }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            margin: 0; 
            overflow-x: hidden; 
            background-color: var(--dark-text); 
            font-family: 'Vazirmatn', sans-serif;
            direction: ltr;
        }
        html, body { scroll-behavior: smooth; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--dark-text); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø³Ø§ÛŒØª (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) --- */
        .nav { position: fixed; width: 100%; background: rgba(0, 0, 0, 0.37); backdrop-filter: blur(5px); border-bottom: 1px solid #9ba3b446; z-index: 1000; display: flex; justify-content: center; transition: opacity 0.5s ease; }
        /* ... Ø³Ø§ÛŒØ± Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø³Ø§ÛŒØª ... */

        /* -------------------------------------------------------------------
           SECRET SYSTEM STYLES (KETABINO - REVISED V2)
           ------------------------------------------------------------------- */
        #secret-container {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 99999; overflow: hidden;
            font-family: 'Vazirmatn', sans-serif;
            direction: rtl; /* Ø¬Ù‡Øª Ú©Ù„ÛŒ Ø³ÛŒØ³ØªÙ… ÙØ§Ø±Ø³ÛŒ */
        }
        
        /* === FIX: Ø¨Ø§Ø²Ø·Ø±Ø§Ø­ÛŒ Ú©Ø§Ù…Ù„ ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† === */
        #login-view {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100%; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            text-align: center;
        }
        .login-box {
            background: rgba(255, 255, 255, 0.7);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 90%;
            max-width: 400px;
        }
        .ketabino-logo { font-size: 2.8rem; font-weight: 900; color: #2c3e50; margin-bottom: 0.5rem; }
        .ketabino-subtitle { font-size: 1.1rem; color: #555; margin-bottom: 30px; }
        .login-input { 
            padding: 15px 20px; border: 2px solid #e1e1e1; border-radius: 12px; 
            width: 100%; text-align: center; font-size: 1.4rem; letter-spacing: 5px;
            margin-bottom: 20px; background: #fff; font-family: 'Vazirmatn', sans-serif;
            transition: all 0.3s;
        }
        .login-input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0, 255, 167, 0.3); outline: none; }
        .login-btn { 
            padding: 15px 40px; background: #3498db; color: white; 
            border: none; border-radius: 12px; cursor: pointer; font-size: 1.2rem;
            width: 100%; font-family: 'Vazirmatn', sans-serif; transition: 0.3s;
            font-weight: 700;
        }
        .login-btn:hover { background: #2980b9; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #login-error { color: var(--red-panic); margin-top: 15px; font-weight: bold; display: none; }


        /* === Chat Styles === */
        #chat-view { display: none; flex-direction: column; height: 100%; background: var(--dark-bg); position: relative; }
        .chat-header {
            padding: 12px 20px; background: var(--medium-bg);
            border-bottom: 1px solid #333; display: flex; 
            justify-content: space-between; align-items: center; gap: 15px;
        }
        .chat-title { color: var(--primary); font-weight: bold; letter-spacing: 1px; }

        /* === FIX: Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ† === */
        #online-count-display {
            display: flex; align-items: center; gap: 8px;
            color: #aaa; font-weight: 500;
        }
        #online-count-display .online-dot {
            width: 10px; height: 10px; background: #2ecc71;
            border-radius: 50%; animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); } 70% { box-shadow: 0 0 0 8px rgba(46, 204, 113, 0); } 100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); } }

        .chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .message {
            max-width: 75%; padding: 10px 18px; border-radius: 18px; 
            position: relative; word-wrap: break-word; line-height: 1.6;
            font-family: 'Vazirmatn', sans-serif;
            display: flex; align-items: center; gap: 10px; /* Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÚ©ÙˆÙ† ØªØ§ÛŒÙ…Ø± */
        }
        /* === FIX: Ø¢ÛŒÚ©ÙˆÙ† ØªØ§ÛŒÙ…Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… === */
        .timer-icon {
            font-size: 0.8rem;
            color: #888;
            animation: spin 60s linear forwards;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .msg-incoming { align-self: flex-start; background: #2a2a2a; border-bottom-left-radius: 4px; color: var(--light-text); }
        .msg-outgoing { align-self: flex-end; background: var(--primary); border-bottom-right-radius: 4px; color: var(--dark-text); font-weight: 500; }
        .msg-img { max-width: 100%; border-radius: 12px; margin-top: 5px; }

        /* === FIX: Ø§Ø³ØªØ§ÛŒÙ„ Ø§ÛŒØ² ØªØ§ÛŒÙ¾ÛŒÙ†Ú¯ === */
        #typing-indicator {
            height: 25px;
            padding: 0 20px;
            color: #888;
            font-style: italic;
            transition: opacity 0.3s;
        }
        .typing-dots span {
            display: inline-block;
            width: 6px; height: 6px; border-radius: 50%;
            background: #888;
            animation: typing-anim 1s infinite;
            margin: 0 1px;
        }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-anim { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }


        .chat-input-area { padding: 15px; background: #111; display: flex; gap: 12px; align-items: center; border-top: 1px solid #333; }
        #msg-input { flex: 1; padding: 15px; border-radius: 30px; border: none; background: #222; color: white; outline: none; font-size: 1rem; font-family: 'Vazirmatn', sans-serif; }
        #file-btn-label { cursor: pointer; color: #888; font-size: 1.8rem; transition: 0.2s; }
        #send-btn { background: var(--primary); color: black; border: none; width: 50px; height: 50px; border-radius: 50%; font-weight: bold; cursor: pointer; font-size: 1.2rem; display: flex; justify-content: center; align-items: center; }

        /* === FIX: Ø¯Ú©Ù…Ù‡ Ù¾Ù†ÛŒÚ© Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ === */
        #desktop-panic-btn { display: block; } /* Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾ */
        #mobile-panic-container { display: none; } /* Ù…Ø®ÙÛŒ Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾ */

        @media (max-width: 600px) {
            .chat-header .chat-title { font-size: 0.9rem; }
            #desktop-panic-btn { display: none; } /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¯Ø± Ù‡Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            #mobile-panic-container {
                display: block;
                position: fixed;
                bottom: 80px; /* Ø¨Ø§Ù„Ø§ÛŒ Ø§ÛŒÙ†Ù¾ÙˆØª Ú†Øª */
                left: 0;
                width: 100%;
                padding: 10px;
                z-index: 1001;
                text-align: center;
            }
            .panic-btn-mobile {
                background: var(--red-panic); color: white; border: none;
                width: 90%; max-width: 400px;
                padding: 18px; border-radius: 15px; font-weight: 900;
                cursor: pointer; font-size: 1.2rem;
                box-shadow: 0 0 25px rgba(255, 27, 76, 0.6);
                animation: pulse-red 1.8s infinite;
            }
            @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(255, 27, 76, 0.6); } 70% { box-shadow: 0 0 0 15px rgba(255, 27, 76, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 27, 76, 0); } }
        }

        /* === FIX: Ø¸Ø§Ù‡Ø± Ø¬Ø¯ÛŒØ¯ ØµÙØ­Ù‡ Ù…Ù‚Ø§Ù„Ù‡ === */
        #panic-view {
            display: none; height: 100%; overflow-y: auto; 
            background: #fdfdfd; color: #333; padding: 20px 15px;
            line-height: 2.2; text-align: justify;
        }
        #panic-view h1 { font-size: 2rem; color: #000; margin-bottom: 10px; text-align: right; border-bottom: 3px solid var(--primary); padding-bottom: 10px; }
        #panic-view .article-meta { font-size: 0.9rem; color: #777; margin-bottom: 30px; }
        #panic-view h2 { font-size: 1.6rem; color: #2c3e50; margin: 40px 0 15px; text-align: right; border-right: 4px solid var(--primary); padding-right: 10px; }
        #panic-view p { font-size: 1.1rem; color: #444; margin-bottom: 20px; }
        #panic-view ul { list-style: none; padding-right: 20px; }
        #panic-view li { margin-bottom: 10px; position: relative; }
        #panic-view li::before { content: 'âœ“'; color: var(--primary); position: absolute; right: -25px; font-weight: bold; }
        .math-block { 
            direction: ltr; /* Ø¨Ø±Ø§ÛŒ ÙØ±Ù…ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø±ÛŒØ§Ø¶ÛŒ */
            background: #eef2f5; padding: 20px; border-radius: 8px; 
            text-align: center; font-family: 'Times New Roman', serif; 
            font-size: 1.3rem; margin: 25px 0; border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .example-box {
            background: #fff; border: 1px solid #e0e0e0; padding: 20px;
            margin: 20px 0; border-radius: 10px;
        }
        .example-box h3 { font-size: 1.2rem; color: #3498db; margin-bottom: 10px; }
    </style>
</head>
<body dir="ltr">
    <!-- Main page content (no changes) -->

    <!-- =======================================================
                    SECRET KETABINO SYSTEM
    ======================================================= -->
    <div id="secret-container">
        <!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø¨Ø§Ø²Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ -->
        <div id="login-view">
            <div class="login-box">
                <div class="ketabino-logo">ğŸ“š Ketabino</div>
                <p class="ketabino-subtitle">Ø³Ø§Ù…Ø§Ù†Ù‡ Ø¬Ø§Ù…Ø¹ Ø¢Ù…ÙˆØ²Ø´ Ø­Ø³Ø§Ø¨Ø§Ù† Ùˆ Ø±ÛŒØ§Ø¶ÛŒØ§Øª</p>
                <input type="password" id="secret-pass" class="login-input" placeholder="_ _ _ _ _ _">
                <button class="login-btn" onclick="checkSecretPass()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡</button>
                <p id="login-error">Ú©Ø¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª</p>
            </div>
        </div>
        <!-- ØµÙØ­Ù‡ Ú†Øª -->
        <div id="chat-view">
            <div class="chat-header">
                <div id="online-count-display">
                    <div class="online-dot"></div>
                    <span id="online-count">0</span> Ù†ÙØ± Ø¢Ù†Ù„Ø§ÛŒÙ†
                </div>
                <span class="chat-title">SECURE CHANNEL</span>
                <button id="desktop-panic-btn" class="panic-btn-mobile" onclick="triggerPanic()">Ø®Ø±ÙˆØ¬ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ</button>
            </div>
            <div id="chat-area" class="chat-area"></div>
            <div id="typing-indicator"></div>
            <div id="mobile-panic-container">
                <button class="panic-btn-mobile" onclick="triggerPanic()">âš  Ø®Ø±ÙˆØ¬ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ</button>
            </div>
            <div class="chat-input-area">
                <label for="file-upload" id="file-btn-label">ğŸ“</label>
                <input type="file" id="file-upload" style="display:none" accept="image/*" onchange="uploadImage()">
                <input type="text" id="msg-input" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." autocomplete="off">
                <button id="send-btn" onclick="sendMessage()">â¤</button>
            </div>
        </div>
        <!-- ØµÙØ­Ù‡ Ù…Ù‚Ø§Ù„Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ -->
        <div id="panic-view">
            <h1>ÙØµÙ„ Ú†Ù‡Ø§Ø±Ù…: Ù…Ø´ØªÙ‚ Ùˆ Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§ÛŒ Ø¢Ù†</h1>
            <p class="article-meta">ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: Û² Ø³Ø§Ø¹Øª Ù¾ÛŒØ´ | Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Ø¯Ú©ØªØ± Ù…Ø­Ù…Ø¯ÛŒ</p>
            
            <h2>Û±. Ù…ÙÙ‡ÙˆÙ… Ø®Ø· Ù…Ù…Ø§Ø³ Ùˆ Ø´ÛŒØ¨</h2>
            <p>ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø³Ø§Ø¦Ù„ Ù…Ù‡Ù… Ú©Ù‡ Ù…Ù†Ø¬Ø± Ø¨Ù‡ Ù¾ÛŒØ¯Ø§ÛŒØ´ Ù…ÙÙ‡ÙˆÙ… Ù…Ø´ØªÙ‚ Ø´Ø¯ØŒ Ù…Ø³Ø¦Ù„Ù‡ ÛŒØ§ÙØªÙ† Ø®Ø· Ù…Ù…Ø§Ø³ Ø¨Ø± Ù…Ù†Ø­Ù†ÛŒ Ø¯Ø± ÛŒÚ© Ù†Ù‚Ø·Ù‡ Ø®Ø§Øµ Ø§Ø³Øª. Ø§Ú¯Ø± Ù…Ù†Ø­Ù†ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± ØªØ§Ø¨Ø¹ Ù¾ÛŒÙˆØ³ØªÙ‡ f Ø¨Ø§Ø´Ø¯ØŒ Ø®Ø· Ù…Ù…Ø§Ø³ Ø¯Ø± Ù†Ù‚Ø·Ù‡ A ÙˆØ¶Ø¹ÛŒØªÛŒ Ø­Ø¯ÛŒ Ø§Ø² Ø®Ø·â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø·Ø¹ AB Ø§Ø³Øª ÙˆÙ‚ØªÛŒ Ú©Ù‡ Ù†Ù‚Ø·Ù‡ B Ø±ÙˆÛŒ Ù…Ù†Ø­Ù†ÛŒ Ø¨Ù‡ Ø³Ù…Øª A Ù…ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
            <div class="math-block">
                m = lim (f(x) - f(a)) / (x - a) &nbsp;&nbsp;&nbsp; as x â†’ a
            </div>
            
            <h2>Û². ØªØ¹Ø±ÛŒÙ Ù…Ø´ØªÙ‚</h2>
            <p>ØªØ§Ø¨Ø¹ f Ø±Ø§ Ø¯Ø± Ù†Ù‚Ø·Ù‡ a Ù…Ø´ØªÙ‚â€ŒÙ¾Ø°ÛŒØ± Ú¯ÙˆÛŒÛŒÙ… Ù‡Ø±Ú¯Ø§Ù‡ Ø­Ø¯ Ø¨Ø§Ù„Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ùˆ Ù…ØªÙ†Ø§Ù‡ÛŒ Ø¨Ø§Ø´Ø¯. Ø§ÛŒÙ† Ø­Ø¯ Ø±Ø§ Ø¨Ø§ f'(a) Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…. Ø¯Ø± ÙˆØ§Ù‚Ø¹ Ù…Ø´ØªÙ‚ØŒ Ù†Ø±Ø® ØªØºÛŒÛŒØ±Ø§Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ ØªØ§Ø¨Ø¹ Ø±Ø§ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù…ØªØºÛŒØ± Ù…Ø³ØªÙ‚Ù„ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. Ø§Ú¯Ø± ØªØ§Ø¨Ø¹ Ø¨ÛŒØ§Ù†Ú¯Ø± Ù…Ú©Ø§Ù† ÛŒÚ© Ù…ØªØ­Ø±Ú© Ø¨Ø± Ø­Ø³Ø¨ Ø²Ù…Ø§Ù† Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø´ØªÙ‚ Ø¢Ù† Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø³Ø±Ø¹Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø§Ø³Øª.</p>
            
            <h2>Û³. Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§ØµÙ„ÛŒ Ù…Ø´ØªÙ‚â€ŒÚ¯ÛŒØ±ÛŒ</h2>
            <p>Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø´ØªÙ‚ ØªÙˆØ§Ø¨Ø¹ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ØŒ Ø§Ø² Ù‚ÙˆØ§Ø¹Ø¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø±ÛŒÙ Ø§ØµÙ„ÛŒ Ø§Ø«Ø¨Ø§Øª Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯:</p>
            <ul>
                <li>Ù…Ø´ØªÙ‚ Ø¹Ø¯Ø¯ Ø«Ø§Ø¨Øª: (c)' = 0</li>
                <li>Ù…Ø´ØªÙ‚ ØªÙˆØ§Ù†: (x^n)' = n * x^(n-1)</li>
                <li>Ù…Ø´ØªÙ‚ Ù…Ø¬Ù…ÙˆØ¹ Ùˆ ØªÙØ§Ø¶Ù„: (u Â± v)' = u' Â± v'</li>
                <li>Ù…Ø´ØªÙ‚ Ø­Ø§ØµÙ„â€ŒØ¶Ø±Ø¨: (uv)' = u'v + uv'</li>
                <li>Ù…Ø´ØªÙ‚ Ø­Ø§ØµÙ„ ØªÙ‚Ø³ÛŒÙ…: (u/v)' = (u'v - uv') / vÂ²</li>
            </ul>

            <h2>Û´. Ù‚Ø§Ø¹Ø¯Ù‡ Ø²Ù†Ø¬ÛŒØ±Ù‡â€ŒØ§ÛŒ (Chain Rule)</h2>
            <p>Ø§ÛŒÙ† Ù‚Ø§Ø¹Ø¯Ù‡ ÛŒÚ©ÛŒ Ø§Ø² Ù‚Ø¯Ø±ØªÙ…Ù†Ø¯ØªØ±ÛŒÙ† Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ Ø¯Ø± Ù…Ø´ØªÙ‚â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø³Øª Ùˆ Ø¨Ø±Ø§ÛŒ ØªÙˆØ§Ø¨Ø¹ ØªÙˆ Ø¯Ø± ØªÙˆ (ØªØ±Ú©ÛŒØ¨ÛŒ) Ø¨Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒØ±ÙˆØ¯. Ø§Ú¯Ø± y = f(u) Ùˆ u = g(x) Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø´ØªÙ‚ y Ù†Ø³Ø¨Øª Ø¨Ù‡ x Ø¨Ø±Ø§Ø¨Ø± Ø§Ø³Øª Ø¨Ø§ Ø­Ø§ØµÙ„â€ŒØ¶Ø±Ø¨ Ù…Ø´ØªÙ‚ y Ù†Ø³Ø¨Øª Ø¨Ù‡ u Ùˆ Ù…Ø´ØªÙ‚ u Ù†Ø³Ø¨Øª Ø¨Ù‡ x.</p>
            <div class="math-block">
                dy/dx = dy/du * du/dx
            </div>
            <div class="example-box">
                <h3>Ù…Ø«Ø§Ù„:</h3>
                <p>Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø´ØªÙ‚ ØªØ§Ø¨Ø¹ y = (xÂ² + 1)Â³ØŒ ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… u = xÂ² + 1. Ø¯Ø± Ø§ÛŒÙ† ØµÙˆØ±Øª y = uÂ³. Ø¯Ø§Ø±ÛŒÙ…:</p>
                <p>dy/du = 3uÂ² = 3(xÂ² + 1)Â²</p>
                <p>du/dx = 2x</p>
                <p>Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ†: y' = (3(xÂ² + 1)Â²) * (2x) = 6x(xÂ² + 1)Â²</p>
            </div>
            
            <h2>Ûµ. Ù†Ù‚Ø§Ø· Ø¨Ø­Ø±Ø§Ù†ÛŒ Ùˆ Ø§Ú©Ø³ØªØ±Ù…Ù…â€ŒÙ‡Ø§</h2>
            <p>Ù†Ù‚Ø§Ø·ÛŒ Ø§Ø² Ø¯Ø§Ù…Ù†Ù‡ ØªØ§Ø¨Ø¹ Ú©Ù‡ Ø¯Ø± Ø¢Ù†â€ŒÙ‡Ø§ Ù…Ø´ØªÙ‚ Ø¨Ø±Ø§Ø¨Ø± ØµÙØ± Ø§Ø³Øª ÛŒØ§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ù†Ù‚Ø§Ø· Ø¨Ø­Ø±Ø§Ù†ÛŒ Ù†Ø§Ù…ÛŒØ¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ø§ÛŒÙ† Ù†Ù‚Ø§Ø· Ú©Ø§Ù†Ø¯ÛŒØ¯Ø§Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø§Ú©Ø²ÛŒÙ…Ù… Ùˆ Ù…ÛŒÙ†ÛŒÙ…Ù… Ù†Ø³Ø¨ÛŒ ØªØ§Ø¨Ø¹ Ù‡Ø³ØªÙ†Ø¯. Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¢Ø²Ù…ÙˆÙ† Ù…Ø´ØªÙ‚ Ø§ÙˆÙ„ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… ØµØ¹ÙˆØ¯ÛŒ ÛŒØ§ Ù†Ø²ÙˆÙ„ÛŒ Ø¨ÙˆØ¯Ù† ØªØ§Ø¨Ø¹ Ø±Ø§ Ø¯Ø± Ø¨Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒÙ….</p>
        </div>
    </div>
    
    <script>
        // Supabase and Chat Scripts
        const SUPABASE_URL = 'https://oklfwsnkaxbqlnjpownj.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9rbGZ3c25rYXhicWxuanBvd25qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwOTkwMTAsImV4cCI6MjA3MzY3NTAxMH0.apanbRV3o5afJ5ivDHimjvYQY1JqawWcIsGemW0jyMg';
        
        const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const validPasswords = ['914920', '920914'];
        let chatChannel; // Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ú©Ø§Ù†Ø§Ù„ Ú†Øª

        // --- Helper Functions ---
        function openKetabino() {
            document.getElementById('secret-container').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        async function triggerPanic() {
            // FIX: Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
            console.log("Panic triggered! Deleting all messages...");
            await db.from('messages').delete().neq('id', 0); // Ù‡Ù…Ù‡ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ Ø±Ø§ Ø­Ø°Ù Ú©Ù†
            
            document.getElementById('chat-view').style.display = 'none';
            document.getElementById('panic-view').style.display = 'block';
            document.getElementById('chat-area').innerHTML = ''; // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙÙˆØ±ÛŒ Ú†Øª Ø¯Ø± Ú©Ù„Ø§ÛŒÙ†Øª
        }
        
        function toEnglishDigits(str) { return str.replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d)); }

        // --- Login Logic ---
        function checkSecretPass() {
            let input = document.getElementById('secret-pass').value;
            if (validPasswords.includes(toEnglishDigits(input))) {
                document.getElementById('login-view').style.display = 'none';
                document.getElementById('chat-view').style.display = 'flex';
                initChat();
            } else {
                const err = document.getElementById('login-error');
                err.style.display = 'block';
                setTimeout(() => err.style.display = 'none', 2000);
            }
        }

        // --- Chat Logic ---
        
        // FIX: Ø±Ù†Ø¯Ø± Ù¾ÛŒØ§Ù… Ø¨Ø§ ØªØ§ÛŒÙ…Ø± Ø­Ø°Ù
        function renderMessage(msg, direction = 'incoming') {
            const chatArea = document.getElementById('chat-area');
            if (document.getElementById('msg-' + msg.id)) return;

            const div = document.createElement('div');
            div.id = 'msg-' + msg.id;
            div.className = `message msg-${direction}`;
            
            // FIX: Ø§ÙØ²ÙˆØ¯Ù† Ø¢ÛŒÚ©ÙˆÙ† ØªØ§ÛŒÙ…Ø±
            const timerIcon = document.createElement('i');
            timerIcon.className = 'fas fa-hourglass-start timer-icon';

            const contentSpan = document.createElement('span');

            if (msg.type === 'image') {
                contentSpan.innerHTML = `<img src="${msg.content}" class="msg-img">`;
            } else {
                contentSpan.textContent = msg.content;
            }
            
            div.appendChild(timerIcon);
            div.appendChild(contentSpan);
            chatArea.appendChild(div);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            // FIX: ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…Ø± 60 Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù¾ÛŒØ§Ù…
            setTimeout(() => {
                div.style.transition = 'opacity 0.5s';
                div.style.opacity = '0';
                setTimeout(() => div.remove(), 500);
            }, 60000);
        }
        
        // FIX: ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ú©Ø§Ù…Ù„Ø§ Ø±ÛŒÙ„-ØªØ§ÛŒÙ…
        async function sendMessage(type = 'text', content = null) {
            const textInput = document.getElementById('msg-input');
            const msgContent = content || textInput.value;
            if (!msgContent.trim()) return;

            // Ù¾ÛŒØ§Ù… Ø¨Ù‡ ØµÙˆØ±Øª outgoing Ø±Ù†Ø¯Ø± Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ú†ÙˆÙ† Ø§Ø² Ø·Ø±ÛŒÙ‚ subscription Ø±ÛŒÙ„-ØªØ§ÛŒÙ… Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯
            if (type === 'text') textInput.value = '';

            await db.from('messages').insert([{ content: msgContent, type: type, user_id: db.auth.user()?.id || 'guest' }]);
            
            // FIX: ØªÙˆÙ‚Ù Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒØ² ØªØ§ÛŒÙ¾ÛŒÙ†Ú¯
            broadcastTypingStatus(false);
        }
        
        // --- Typing Indicator Logic ---
        let typingTimer;
        const typingTimeout = 1500; // ms

        function broadcastTypingStatus(isTyping) {
            if (chatChannel) {
                chatChannel.track({ is_typing: isTyping });
            }
        }
        
        document.getElementById('msg-input').addEventListener('input', () => {
            clearTimeout(typingTimer);
            broadcastTypingStatus(true);
            typingTimer = setTimeout(() => {
                broadcastTypingStatus(false);
            }, typingTimeout);
        });

        document.getElementById('msg-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                clearTimeout(typingTimer);
                sendMessage();
            }
        });

        // --- Init Chat and Subscriptions ---
        function initChat() {
            const chatArea = document.getElementById('chat-area');
            chatArea.innerHTML = ''; 

            // FIX: Ú©Ø§Ù†Ø§Ù„ Ø±ÛŒÙ„-ØªØ§ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ú†ÛŒØ² (Ù¾ÛŒØ§Ù…ØŒ Ø­Ø¶ÙˆØ±ØŒ ØªØ§ÛŒÙ¾ÛŒÙ†Ú¯)
            chatChannel = db.channel('main-room', {
                config: {
                    presence: { key: 'user-' + Date.now() }, // Ú©Ù„ÛŒØ¯ ÛŒÚ©ØªØ§ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø±
                }
            });
            
            // 1. Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ (Ú©Ø§Ù…Ù„Ø§ Real-time)
            chatChannel.on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
                // ØªØ´Ø®ÛŒØµ Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø¯ÛŒÚ¯Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ§ÛŒÙ„â€ŒØ¯Ù‡ÛŒ
                const direction = (payload.new.user_id === (db.auth.user()?.id || 'guest')) ? 'outgoing' : 'incoming';
                renderMessage(payload.new, 'outgoing'); // Ù‡Ù…Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø±Ø§ outgoing Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú†ÙˆÙ† user_id ÙØ¹Ù„Ø§ Ø³Ø§Ø¯Ù‡ Ø§Ø³Øª
            });
            
            // 2. Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø­Ø¶ÙˆØ± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø¢Ù†Ù„Ø§ÛŒÙ†/Ø¢ÙÙ„Ø§ÛŒÙ†)
            chatChannel.on('presence', { event: 'sync' }, () => {
                const presenceState = chatChannel.presenceState();
                const count = Object.keys(presenceState).length;
                document.getElementById('online-count').textContent = count;
            });

            // 3. Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯ "is typing"
            const typingIndicator = document.getElementById('typing-indicator');
            const typingUsers = {};
            
            chatChannel.on('presence_diff', { event: 'join' }, ({ newPresences }) => {
                // Optional: Handle new user join notifications
            });

            chatChannel.on('presence_diff', { event: 'leave' }, ({ leftPresences }) => {
                // Optional: Handle user leave
                leftPresences.forEach(p => {
                    delete typingUsers[p.key];
                });
                updateTypingIndicator();
            });

            chatChannel.on('broadcast', { event: 'typing' }, ({ payload }) => {
                 if(payload.is_typing) {
                     typingUsers[payload.from_user_key] = Date.now();
                 } else {
                     delete typingUsers[payload.from_user_key];
                 }
                 updateTypingIndicator();
            });

            function updateTypingIndicator() {
                const now = Date.now();
                const activeTypers = Object.keys(typingUsers).filter(key => now - typingUsers[key] < 2000);
                
                if (activeTypers.length > 0) {
                    const text = activeTypers.length === 1 ? 'ÛŒÚ© Ù†ÙØ± Ø¯Ø± Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ† Ø§Ø³Øª' : `${activeTypers.length} Ù†ÙØ± Ø¯Ø± Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ† Ù‡Ø³ØªÙ†Ø¯`;
                    typingIndicator.innerHTML = `${text} <span class="typing-dots"><span></span><span></span><span></span></span>`;
                } else {
                    typingIndicator.innerHTML = '';
                }
            }


            // Ø§ØªØµØ§Ù„ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„
            chatChannel.subscribe(async (status) => {
                if (status === 'SUBSCRIBED') {
                    // Ø«Ø¨Øª Ø­Ø¶ÙˆØ± Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ú©Ø§Ù†Ø§Ù„
                    await chatChannel.track({ online_at: new Date().toISOString() });
                    console.log('Successfully connected to the real-time channel!');
                }
            });
        }

    </script>
</body>
</html>
